<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #1e293b 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            padding: 8px;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .nav-tab {
            flex: 1;
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #94a3b8;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-tab:hover {
            background: rgba(51, 65, 85, 0.5);
            color: white;
        }

        .nav-tab:active {
            transform: scale(0.98);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            pointer-events: none;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Checklist Styles */
        .header-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            margin-bottom: 24px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 32px;
            color: #1e293b;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #1e293b;
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .progress-card {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 12px;
            padding: 24px;
            color: white;
            margin-bottom: 24px;
        }

        .progress-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .progress-text {
            font-size: 14px;
            opacity: 0.9;
        }

        .progress-number {
            font-size: 36px;
            font-weight: bold;
            margin-top: 5px;
        }

        .status-badge {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 18px;
        }

        .status-ready {
            background: #22c55e;
        }

        .status-wait {
            background: #ef4444;
        }

        .trade-type-selector {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            text-align: center;
        }

        .selector-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .type-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .type-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .type-btn-long {
            background: #22c55e;
        }

        .type-btn-long:hover {
            background: #16a34a;
        }

        .type-btn-short {
            background: #ef4444;
        }

        .type-btn-short:hover {
            background: #dc2626;
        }

        .selected-type {
            background: #f1f5f9;
            border: 2px solid #64748b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .selected-type-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .selected-type-icon {
            font-size: 32px;
        }

        .selected-type-label {
            font-size: 12px;
            color: #64748b;
        }

        .selected-type-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
            margin-top: 4px;
        }

        .section {
            border: 2px solid;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .section-blue { background: #eff6ff; border-color: #bfdbfe; }
        .section-purple { background: #faf5ff; border-color: #e9d5ff; }
        .section-orange { background: #fff7ed; border-color: #fed7aa; }
        .section-green { background: #f0fdf4; border-color: #bbf7d0; }
        .section-red { background: #fef2f2; border-color: #fecaca; }
        .section-indigo { background: #eef2ff; border-color: #c7d2fe; }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 16px;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checklist-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checkbox.checked {
            background: #22c55e;
            border-color: #22c55e;
            color: white;
        }

        .item-content {
            flex: 1;
        }

        .item-text {
            font-weight: 500;
            color: #1e293b;
        }

        .item-text.checked {
            color: #64748b;
            text-decoration: line-through;
        }

        .critical-badge {
            display: inline-block;
            margin-top: 6px;
            padding: 4px 8px;
            background: #fee2e2;
            color: #991b1b;
            font-size: 11px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* Journal Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }

        .stat-sub {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            padding: 4px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .filter-btn:hover {
            color: white;
        }

        .filter-btn.active {
            background: #475569;
            color: white;
        }

        .filter-btn.win.active {
            background: #22c55e;
        }

        .filter-btn.loss.active {
            background: #ef4444;
        }

        .form-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .form-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .form-input, .form-select, .form-textarea {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 10px 16px;
            color: white;
            font-size: 14px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #e2e8f0;
            cursor: pointer;
        }

        .checkbox-input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        .btn-success {
            flex: 1;
            background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
            color: white;
            padding: 12px;
            font-size: 16px;
        }

        .btn-cancel {
            padding: 12px 24px;
            background: #475569;
            color: white;
        }

        .btn-cancel:hover {
            background: #334155;
        }

        .trade-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid;
        }

        .trade-card.win {
            border-color: rgba(34, 197, 94, 0.3);
        }

        .trade-card.loss {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .trade-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .trade-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: bold;
        }

        .trade-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: #94a3b8;
        }

        .trade-result {
            text-align: left;
        }

        .trade-points {
            font-size: 36px;
            font-weight: bold;
        }

        .trade-points.positive {
            color: #22c55e;
        }

        .trade-points.negative {
            color: #ef4444;
        }

        .trade-rr {
            font-size: 14px;
            color: #94a3b8;
        }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .trade-detail-label {
            color: #64748b;
        }

        .trade-detail-value {
            font-weight: 600;
            margin-right: 8px;
        }

        .trade-notes {
            border-top: 1px solid #334155;
            padding-top: 16px;
            margin-top: 16px;
        }

        .trade-note-item {
            margin-bottom: 12px;
            font-size: 14px;
        }

        .trade-note-label {
            color: #94a3b8;
        }

        .trade-badges {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-icon {
            font-size: 48px;
            opacity: 0.5;
            margin-bottom: 16px;
        }

        .notes-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            margin-top: 24px;
        }

        .notes-content {
            display: flex;
            gap: 15px;
        }

        .notes-icon {
            color: #eab308;
            font-size: 24px;
            flex-shrink: 0;
        }

        .notes-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .notes-list {
            list-style: none;
            font-size: 14px;
            color: #64748b;
        }

        .notes-list li {
            margin-bottom: 6px;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }

            h1 {
                font-size: 24px;
            }

            .progress-number {
                font-size: 28px;
            }

            .status-badge {
                font-size: 16px;
                padding: 10px 20px;
            }
        }

        /* Export Buttons */
        .export-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .btn-export {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            font-size: 14px;
        }

        .btn-excel {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-pdf {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" id="tab-checklist">
                <span>âœ…</span>
                <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚</span>
            </button>
            <button class="nav-tab" id="tab-journal">
                <span>ğŸ“Š</span>
                <span>Ø¯ÙØªØ± Ø§Ù„ØªØ¯Ø§ÙˆÙ„</span>
            </button>
        </div>

        <!-- Checklist Tab -->
        <div id="checklist-tab" class="tab-content active">
            <div class="header-card">
                <div class="header-top">
                    <h1>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
                    <button class="btn btn-secondary" id="resetChecklistBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                </div>
                
                <div class="progress-card">
                    <div class="progress-content">
                        <div>
                            <div class="progress-text">Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø­Ø±Ø¬Ø© Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©</div>
                            <div class="progress-number" id="progressCount">0 / 0</div>
                        </div>
                        <div class="status-badge status-wait" id="statusBadge">â¸ï¸ Ø§Ù†ØªØ¸Ø±</div>
                    </div>
                </div>

                <div id="tradeTypeSelector" class="trade-type-selector">
                    <div class="selector-title">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØµÙÙ‚Ø©:</div>
                    <div class="type-buttons">
                        <button class="type-btn type-btn-long" id="selectLongBtn">
                            <span>ğŸ“ˆ</span> Ø´Ø±Ø§Ø¡ (LONG)
                        </button>
                        <button class="type-btn type-btn-short" id="selectShortBtn">
                            <span>ğŸ“‰</span> Ø¨ÙŠØ¹ (SHORT)
                        </button>
                    </div>
                </div>

                <div id="selectedType" class="selected-type" style="display: none;">
                    <div class="selected-type-info">
                        <div class="selected-type-icon" id="typeIcon">ğŸ“ˆ</div>
                        <div>
                            <div class="selected-type-label">Ù†ÙˆØ¹ Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:</div>
                            <div class="selected-type-value" id="typeValue">Ø´Ø±Ø§Ø¡ (LONG) ğŸ“ˆ</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="changeTypeBtn">ØªØºÙŠÙŠØ±</button>
                </div>
            </div>

            <div id="checklistSections"></div>

            <div class="notes-card">
                <div class="notes-content">
                    <div class="notes-icon">âš ï¸</div>
                    <div>
                        <div class="notes-title">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:</div>
                        <ul class="notes-list">
                            <li>â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù‚Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø­Ø±Ø¬Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</li>
                            <li>â€¢ Ù„Ø§ ØªØªØ¯Ø§ÙˆÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¤Ø´Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·</li>
                            <li>â€¢ Ø§Ù„ØªØ²Ù… Ø¨Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ‚Ù ÙˆØ§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</li>
                            <li>â€¢ Ø¥Ø°Ø§ Ù„Ù… ØªØªØ­Ù‚Ù‚ Ø§Ù„Ø´Ø±ÙˆØ·ØŒ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Journal Tab -->
        <div id="journal-tab" class="tab-content">
            <div style="margin-bottom: 32px;">
                <h1 style="font-size: 36px; font-weight: bold; margin-bottom: 8px; background: linear-gradient(135deg, #60a5fa 0%, #22d3ee 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    Ø¯ÙØªØ± Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
                </h1>
                <p style="color: #94a3b8;">DAX Day Trading Journal</p>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙÙ‚Ø§Øª</div>
                    <div class="stat-value" id="totalTrades">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙÙˆØ²</div>
                    <div class="stat-value" style="color: #22c55e;" id="winRate">0%</div>
                    <div class="stat-sub" id="winLoss">0W / 0L</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                    <div class="stat-value" id="totalPoints">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·</div>
                    <div class="stat-value" style="color: #22d3ee;" id="disciplineRate">0%</div>
                    <div class="stat-sub" id="avgRR">Avg R:R 0</div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls" id="journalControls">
                <button class="btn btn-primary" id="addTradeBtn">
                    <span>â•</span>
                    <span>Ø¥Ø¶Ø§ÙØ© ØµÙÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                </button>

                <div class="filter-group">
                    <button class="filter-btn active" id="filterAll">Ø§Ù„ÙƒÙ„</button>
                    <button class="filter-btn win" id="filterWin">Ø§Ù„Ø±Ø¨Ø­</button>
                    <button class="filter-btn loss" id="filterLoss">Ø§Ù„Ø®Ø³Ø§Ø±Ø©</button>
                </div>
            </div>

            <!-- Export Buttons -->
            <div class="export-group">
                <button class="btn btn-export btn-excel" id="exportExcelBtn">
                    <span>ğŸ“Š</span>
                    <span>ØªØµØ¯ÙŠØ± Excel</span>
                </button>
                <button class="btn btn-export btn-pdf" id="exportPdfBtn">
                    <span>ğŸ“„</span>
                    <span>ØªØµØ¯ÙŠØ± PDF</span>
                </button>
            </div>

            <!-- Trade Form -->
            <div id="tradeForm" class="form-card" style="display: none;">
                <h2 class="form-title">ØªØ³Ø¬ÙŠÙ„ ØµÙÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <form onsubmit="submitTrade(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="tradeDate" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆÙ‚Øª</label>
                            <input type="time" id="tradeTime" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</label>
                            <select id="tradeSetup" class="form-select">
                                <option value="pullback-vwap">Ø§Ø±ØªØ¯Ø§Ø¯ Ù…Ù† VWAP</option>
                                <option value="breakout">ÙƒØ³Ø± Ù…Ø³ØªÙˆÙ‰</option>
                                <option value="range-trade">ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù†Ø·Ø§Ù‚</option>
                                <option value="trend-continuation">Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§ØªØ¬Ø§Ù‡</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø§ØªØ¬Ø§Ù‡</label>
                            <select id="tradeDirection" class="form-select">
                                <option value="buy">Ø´Ø±Ø§Ø¡ (Long)</option>
                                <option value="sell">Ø¨ÙŠØ¹ (Short)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
                            <input type="number" step="0.1" id="tradeEntry" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Stop Loss</label>
                            <input type="number" step="0.1" id="tradeStop" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù‡Ø¯Ù</label>
                            <input type="number" step="0.1" id="tradeTarget" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù†Ù‚Ø·Ø© Ø§Ù„Ø®Ø±ÙˆØ¬</label>
                            <input type="number" step="0.1" id="tradeExit" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="tradeFollowedRules" class="checkbox-input" checked>
                            <span>Ù‡Ù„ Ø§Ù„ØªØ²Ù…Øª Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ØŸ</span>
                        </label>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¯Ø§ÙˆÙ„</label>
                        <input type="text" id="tradeEmotions" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ù‡Ø§Ø¯Ø¦ØŒ Ù…ØªÙˆØªØ±ØŒ ÙˆØ§Ø«Ù‚...">
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØªØ¹Ù„Ù…</label>
                        <textarea id="tradeNotes" class="form-textarea" placeholder="Ù…Ø§Ø°Ø§ ØªØ¹Ù„Ù…Øª Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙÙ‚Ø©ØŸ"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">Ø­ÙØ¸ Ø§Ù„ØµÙÙ‚Ø©</button>
                        <button type="button" class="btn btn-cancel" id="cancelTradeBtn">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>

            <!-- Trades List -->
            <div id="tradesList"></div>
        </div>
    </div>

    <script>
        // =============================
        // âœ… ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª (Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª)
        // =============================
        // SheetJS (xlsx) - Base64 encoded (ØµØºÙŠØ± Ø¬Ø¯Ù‹Ø§)
        const xlsxBase64 = "UEsDBBQAAAAIAJZ...";
        // âš ï¸ Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§ØªØŒ ØªÙ… Ø§Ø®ØªØµØ§Ø±Ù‡Ø§ Ù‡Ù†Ø§ Ù„Ø£Ø³Ø¨Ø§Ø¨ ØªÙ‚Ù†ÙŠØ©.
        // Ù„ÙƒÙ† ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ø³Ø£Ø³ØªØ®Ø¯Ù… Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø®ÙÙŠÙØ© Ù„Ø§ ØªØ­ØªØ§Ø¬ Base64.

        // âœ… Ø§Ù„Ø­Ù„ Ø§Ù„Ø£Ù…Ø«Ù„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯ÙˆØ§Ù„ ØªØµØ¯ÙŠØ± Ù…Ø¯Ù…Ø¬Ø© (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©)
        // Ù„Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ØªØ¯Ø¹Ù… ØªØµØ¯ÙŠØ± CSV ÙˆPDF Ø¹Ø¨Ø± jsPDF/html2canvas Ù…Ø¯Ù…Ø¬ÙŠÙ†.

        // Ù„ÙƒÙ† Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ù…Ù„ offline ÙˆØ³Ù„Ø§Ø³Ø©ØŒ Ø³Ø£Ø³ØªØ®Ø¯Ù…:
        // - CSV Ø¨Ø³ÙŠØ· Ù„Ù€ Excel (ÙŠØ¯Ø¹Ù…Ù‡ Excel ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§)
        // - jsPDF + html2canvas ÙƒÙ€ Ù†Ø³Ø®Ø© Ù…ØµØºØ±Ø© Ù…Ø¶Ù…Ù†Ø©

        // Ø³Ø£Ø¶ÙŠÙ Ù…ÙƒØªØ¨Ø© html2canvas Ùˆ jsPDF Ù…Ø¨Ø§Ø´Ø±Ø© (Ù†Ø³Ø®Ø© Ù…Ø¶ØºÙˆØ·Ø© Ø¬Ø¯Ù‹Ø§)
        // âš ï¸ Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù…ÙƒØªØ¨Ø§ØªØŒ Ù„ÙƒÙ†Ù‡ ÙŠØ¹Ù…Ù„ 100% offline.

        // ======================================
        // âœ… Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµØ¯ÙŠØ± (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ù„Ù€ Excel)
        // ======================================

        // Export to Excel (CSV) - ÙŠÙØªØ­ ÙÙŠ Excel ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
        function exportToExcel() {
            if (trades.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±!');
                return;
            }

            // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            const headers = [
                'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯', 'Ø§Ù„Ø§ØªØ¬Ø§Ù‡', 'Ø§Ù„Ø¯Ø®ÙˆÙ„', 
                'Ø§Ù„ÙˆÙ‚Ù', 'Ø§Ù„Ù‡Ø¯Ù', 'Ø§Ù„Ø®Ø±ÙˆØ¬', 'Ø§Ù„Ù†Ù‚Ø§Ø·', 'R:R', 
                'Ø±Ø¨Ø­/Ø®Ø³Ø§Ø±Ø©', 'Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·', 'Ø§Ù„Ù…Ø´Ø§Ø¹Ø±', 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª'
            ];

            // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const rows = trades.map(trade => {
                const setupNames = {
                    'pullback-vwap': 'Ø§Ø±ØªØ¯Ø§Ø¯ Ù…Ù† VWAP',
                    'breakout': 'ÙƒØ³Ø± Ù…Ø³ØªÙˆÙ‰',
                    'range-trade': 'ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù†Ø·Ø§Ù‚',
                    'trend-continuation': 'Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§ØªØ¬Ø§Ù‡'
                };
                return [
                    trade.date,
                    trade.time,
                    setupNames[trade.setup] || trade.setup,
                    trade.direction === 'buy' ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹',
                    trade.entry.toFixed(1),
                    trade.stop.toFixed(1),
                    trade.target.toFixed(1),
                    trade.exit.toFixed(1),
                    trade.points.toFixed(1),
                    trade.rr.toFixed(2),
                    trade.isWin ? 'Ø±Ø¨Ø­' : 'Ø®Ø³Ø§Ø±Ø©',
                    trade.followedRules ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                    `"${trade.emotions || ''}"`,
                    `"${trade.notes || ''}"`
                ];
            });

            // Ø¥Ù†Ø´Ø§Ø¡ CSV
            let csv = '\uFEFF'; // Ù„Ø¯Ø¹Ù… UTF-8 ÙÙŠ Excel
            csv += headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.join(',') + '\n';
            });

            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ÙˆØªÙ†Ø²ÙŠÙ„Ù‡
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ø¯ÙØªØ±_ØªØ¯Ø§ÙˆÙ„_DAX_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }

        // Export to PDF (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… jsPDF Ùˆ html2canvas Ù…Ø¯Ù…Ø¬ÙŠÙ†)
        async function exportToPDF() {
            if (trades.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±!');
                return;
            }

            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
            const loading = document.createElement('div');
            loading.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.7); display: flex; align-items: center; 
                justify-content: center; z-index: 10000; color: white; font-size: 20px;
            `;
            loading.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF... â³';
            document.body.appendChild(loading);

            try {
                // ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© html2canvas Ùˆ jsPDF Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ (Ø¨Ø¯ÙˆÙ† CDN)
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                await new Promise((resolve) => {
                    script.onload = resolve;
                    script.onerror = () => {
                        alert('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªØµØ¯ÙŠØ±. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.');
                        document.body.removeChild(loading);
                    };
                    document.head.appendChild(script);
                });

                const jsPDFScript = document.createElement('script');
                jsPDFScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                await new Promise((resolve) => {
                    jsPDFScript.onload = resolve;
                    document.head.appendChild(jsPDFScript);
                });

                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù…Ø¤Ù‚Øª Ù„Ù„ØªÙ‚Ø±ÙŠØ±
                const reportElement = document.createElement('div');
                reportElement.dir = 'rtl';
                reportElement.style.cssText = `
                    padding: 40px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    background: white; color: #1e293b; max-width: 800px; margin: 0 auto;
                    direction: rtl; text-align: right;
                `;
                reportElement.innerHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="color: #1e40af; font-size: 28px;">Ø¯ÙØªØ± Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</h1>
                        <p style="color: #64748b; font-size: 16px;">DAX Day Trading Journal</p>
                        <p style="color: #64748b;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</p>
                    </div>

                    <div style="background: #f1f5f9; padding: 15px; border-radius: 8px; margin-bottom: 25px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙÙ‚Ø§Øª:</strong> ${trades.length}</div>
                            <div><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙÙˆØ²:</strong> ${Math.round((trades.filter(t => t.isWin).length / trades.length) * 100) || 0}%</div>
                            <div><strong>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${trades.reduce((sum, t) => sum + t.points, 0).toFixed(1)}</div>
                            <div><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·:</strong> ${Math.round((trades.filter(t => t.followedRules).length / trades.length) * 100) || 0}%</div>
                        </div>
                    </div>

                    <h2 style="color: #1e293b; margin: 25px 0 15px; border-bottom: 2px solid #cbd5e1; padding-bottom: 8px;">Ø§Ù„ØµÙÙ‚Ø§Øª (${trades.length})</h2>
                `;

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙ‚Ø§Øª
                trades.forEach((trade, index) => {
                    const color = trade.isWin ? '#dcfce7' : '#fee2e2';
                    const borderColor = trade.isWin ? '#22c55e' : '#ef4444';
                    const sign = trade.points >= 0 ? '+' : '';

                    reportElement.innerHTML += `
                        <div style="background: ${color}; border-right: 4px solid ${borderColor}; margin-bottom: 20px; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>${index + 1}. ${(trade.setup === 'pullback-vwap' ? 'Ø§Ø±ØªØ¯Ø§Ø¯ Ù…Ù† VWAP' : 
                                    trade.setup === 'breakout' ? 'ÙƒØ³Ø± Ù…Ø³ØªÙˆÙ‰' :
                                    trade.setup === 'range-trade' ? 'ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù†Ø·Ø§Ù‚' :
                                    'Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§ØªØ¬Ø§Ù‡')}</strong>
                                <span style="color: ${trade.isWin ? '#16a34a' : '#dc2626'};">${trade.isWin ? 'âœ… Ø±Ø¨Ø­' : 'âŒ Ø®Ø³Ø§Ø±Ø©'}</span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 14px;">
                                <div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${trade.date} ${trade.time}</div>
                                <div><strong>Ø§Ù„Ø§ØªØ¬Ø§Ù‡:</strong> ${trade.direction === 'buy' ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹'}</div>
                                <div><strong>Ø§Ù„Ø¯Ø®ÙˆÙ„:</strong> ${trade.entry.toFixed(1)}</div>
                                <div><strong>Ø§Ù„ÙˆÙ‚Ù:</strong> ${trade.stop.toFixed(1)}</div>
                                <div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> ${trade.target.toFixed(1)}</div>
                                <div><strong>Ø§Ù„Ø®Ø±ÙˆØ¬:</strong> ${trade.exit.toFixed(1)}</div>
                                <div><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> <span style="color: ${trade.points >= 0 ? '#16a34a' : '#dc2626'};">${sign}${trade.points.toFixed(1)}</span></div>
                                <div><strong>R:R:</strong> ${trade.rr.toFixed(2)}</div>
                                <div><strong>Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·:</strong> ${trade.followedRules ? 'âœ”ï¸ Ù†Ø¹Ù…' : 'âš ï¸ Ù„Ø§'}</div>
                                <div><strong>Ø§Ù„Ù…Ø´Ø§Ø¹Ø±:</strong> ${trade.emotions || 'â€”'}</div>
                            </div>
                            ${trade.notes ? `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #94a3b8; font-size: 14px;">
                                <strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${trade.notes}
                            </div>` : ''}
                        </div>
                    `;
                });

                document.body.appendChild(reportElement);

                // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ù€ PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                await html2canvas(reportElement, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: null
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 210; // A4 width in mm
                    const pageHeight = 295;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    pdf.save(`ØªÙ‚Ø±ÙŠØ±_ØªØ¯Ø§ÙˆÙ„_DAX_${new Date().toISOString().split('T')[0]}.pdf`);
                });

                // ØªÙ†Ø¸ÙŠÙ
                document.body.removeChild(reportElement);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PDF. Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            } finally {
                document.body.removeChild(loading);
            }
        }

        // =============================
        // âœ… Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)
        // =============================
        let checks = {};
        let tradeType = null;
        let trades = JSON.parse(localStorage.getItem('trades')) || [];
        let currentFilter = 'all';

        const sections = [
            {
                title: '1ï¸âƒ£ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø³ÙˆÙ‚ (Dow Theory)',
                color: 'blue',
                items: [
                    { id: 'dow_trend', text: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø­Ø§Ù„ÙŠ (HH/HL Ù„Ù„ØµØ¹ÙˆØ¯ | LH/LL Ù„Ù„Ù‡Ø¨ÙˆØ·)', critical: true },
                    { id: 'pivot_confirm', text: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ù…Ù… ÙˆØ§Ù„Ù‚ÙŠØ¹Ø§Ù† Ø§Ù„Ø£Ø®ÙŠØ±Ø© (3 Ø´Ù…ÙˆØ¹ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø±)', critical: true }
                ]
            },
            {
                title: '2ï¸âƒ£ Ø§Ù„Ø³ÙŠØ§Ù‚ (Context)',
                color: 'purple',
                items: [
                    { id: 'vwap_position', text: '', critical: true },
                    { id: 'dow_vwap_align', text: 'Ø§ØªØ¬Ø§Ù‡ Dow + VWAP Ù…ØªÙˆØ§ÙÙ‚Ø§Ù†', critical: true }
                ]
            },
            {
                title: '3ï¸âƒ£ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
                color: 'red',
                items: [
                    { id: 'rr_ratio', text: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©: Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© â‰¥ 1:1.5', critical: true },
                    { id: 'risk_per_trade', text: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© â‰¤ 1% Ù…Ù† Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„', critical: true }
                ]
            },
            {
                title: '4ï¸âƒ£ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Entry)',
                color: 'green',
                items: [
                    { id: 'entry_trigger', text: 'Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ø¶Ø­ (Ø§Ø®ØªØ±Ø§Ù‚ØŒ Ø§Ø±ØªØ¯Ø§Ø¯ØŒ ØªØ£ÙƒÙŠØ¯ Ù…Ø¤Ø´Ø±)', critical: false },
                    { id: 'volume_confirm', text: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„', critical: false }
                ]
            },
            {
                title: '5ï¸âƒ£ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù†ÙØ³ÙŠ',
                color: 'indigo',
                items: [
                    { id: 'emotional_state', text: 'Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© Ù…Ø³ØªÙ‚Ø±Ø© (Ù„Ø§ Ø·Ù…Ø¹ / Ù„Ø§ Ø®ÙˆÙ)', critical: true },
                    { id: 'plan_followed', text: 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø®Ø·Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¨Ù‚Ø©', critical: true }
                ]
            }
        ];

        // DOM Elements
        const tabChecklist = document.getElementById('tab-checklist');
        const tabJournal = document.getElementById('tab-journal');
        const checklistTab = document.getElementById('checklist-tab');
        const journalTab = document.getElementById('journal-tab');
        const checklistSections = document.getElementById('checklistSections');
        const resetChecklistBtn = document.getElementById('resetChecklistBtn');
        const tradeTypeSelector = document.getElementById('tradeTypeSelector');
        const selectedType = document.getElementById('selectedType');
        const typeIcon = document.getElementById('typeIcon');
        const typeValue = document.getElementById('typeValue');
        const changeTypeBtn = document.getElementById('changeTypeBtn');
        const selectLongBtn = document.getElementById('selectLongBtn');
        const selectShortBtn = document.getElementById('selectShortBtn');
        const progressCount = document.getElementById('progressCount');
        const statusBadge = document.getElementById('statusBadge');
        const addTradeBtn = document.getElementById('addTradeBtn');
        const tradeForm = document.getElementById('tradeForm');
        const cancelTradeBtn = document.getElementById('cancelTradeBtn');
        const filterAll = document.getElementById('filterAll');
        const filterWin = document.getElementById('filterWin');
        const filterLoss = document.getElementById('filterLoss');
        const tradesList = document.getElementById('tradesList');
        const totalTradesEl = document.getElementById('totalTrades');
        const winRateEl = document.getElementById('winRate');
        const winLossEl = document.getElementById('winLoss');
        const totalPointsEl = document.getElementById('totalPoints');
        const disciplineRateEl = document.getElementById('disciplineRate');
        const avgRREl = document.getElementById('avgRR');
        const journalControls = document.getElementById('journalControls');
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const exportPdfBtn = document.getElementById('exportPdfBtn');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Add "Clear All" button
            const clearAllBtn = document.createElement('button');
            clearAllBtn.className = 'btn btn-secondary';
            clearAllBtn.style.backgroundColor = '#dc2626';
            clearAllBtn.style.color = 'white';
            clearAllBtn.style.marginLeft = 'auto';
            clearAllBtn.innerHTML = 'ğŸ§¹ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
            clearAllBtn.onclick = confirmClearAll;
            journalControls.appendChild(clearAllBtn);

            // Add event listeners for export
            exportExcelBtn.addEventListener('click', exportToExcel);
            exportPdfBtn.addEventListener('click', exportToPDF);

            renderChecklist();
            renderStats();
            renderTrades();
            updateVWAPText();

            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tradeDate').value = today;
        });

        // Tab Navigation
        tabChecklist.addEventListener('click', () => {
            checklistTab.classList.add('active');
            journalTab.classList.remove('active');
            tabChecklist.classList.add('active');
            tabJournal.classList.remove('active');
        });

        tabJournal.addEventListener('click', () => {
            journalTab.classList.add('active');
            checklistTab.classList.remove('active');
            tabJournal.classList.add('active');
            tabChecklist.classList.remove('active');
        });

        // Trade Type Selection
        selectLongBtn.addEventListener('click', () => setTradeType('long'));
        selectShortBtn.addEventListener('click', () => setTradeType('short'));
        changeTypeBtn.addEventListener('click', () => {
            selectedType.style.display = 'none';
            tradeTypeSelector.style.display = 'block';
            tradeType = null;
            updateStatus();
        });

        function setTradeType(type) {
            tradeType = type;
            const isLong = type === 'long';
            typeIcon.textContent = isLong ? 'ğŸ“ˆ' : 'ğŸ“‰';
            typeValue.textContent = isLong ? 'Ø´Ø±Ø§Ø¡ (LONG) ğŸ“ˆ' : 'Ø¨ÙŠØ¹ (SHORT) ğŸ“‰';
            selectedType.style.display = 'flex';
            tradeTypeSelector.style.display = 'none';
            updateVWAPText();
            updateStatus();
        }

        function updateVWAPText() {
            const vwapSection = sections.find(s => s.items.some(i => i.id === 'vwap_position'));
            if (!vwapSection) return;
            
            const vwapItem = vwapSection.items.find(i => i.id === 'vwap_position');
            if (!vwapItem) return;

            let text = '';
            if (tradeType === 'long') {
                text = 'Ø§Ù„Ø³Ø¹Ø± ÙÙˆÙ‚ VWAP Ù„Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµØ§Ø¹Ø¯';
            } else if (tradeType === 'short') {
                text = 'Ø§Ù„Ø³Ø¹Ø± Ø¯ÙˆÙ† VWAP Ù„Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‡Ø§Ø¨Ø·';
            } else {
                text = 'Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„ØµÙÙ‚Ø© Ø£ÙˆÙ„Ø§Ù‹';
            }
            vwapItem.text = text;

            // Update UI if rendered
            const vwapEl = document.querySelector(`.checklist-item[data-id="vwap_position"] .item-text`);
            if (vwapEl) vwapEl.textContent = text;
        }

        // Checklist Rendering
        function renderChecklist() {
            let html = '';
            sections.forEach(section => {
                html += `
                    <div class="section section-${section.color}">
                        <div class="section-title">${section.title}</div>
                        ${section.items.map(item => {
                            const isChecked = checks[item.id] || false;
                            const isCritical = item.critical;
                            return `
                                <div class="checklist-item" data-id="${item.id}">
                                    <div class="checkbox ${isChecked ? 'checked' : ''}">
                                        ${isChecked ? 'âœ“' : ''}
                                    </div>
                                    <div class="item-content">
                                        <div class="item-text ${isChecked ? 'checked' : ''}">${item.text}</div>
                                        ${isCritical ? '<span class="critical-badge">Ø­Ø±Ø¬</span>' : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            });
            checklistSections.innerHTML = html;

            // Add event listeners
            document.querySelectorAll('.checklist-item').forEach(item => {
                item.addEventListener('click', () => toggleCheck(item.dataset.id));
            });
        }

        // Toggle Check
        function toggleCheck(id) {
            checks[id] = !checks[id];
            renderChecklist();
            updateStatus();
        }

        // Reset Checklist
        resetChecklistBtn.addEventListener('click', () => {
            checks = {};
            renderChecklist();
            updateStatus();
        });

        // Update Progress & Status
        function updateStatus() {
            const criticalItems = sections.flatMap(s => s.items.filter(i => i.critical));
            const checkedCritical = criticalItems.filter(item => checks[item.id]).length;
            const totalCritical = criticalItems.length;
            
            progressCount.textContent = `${checkedCritical} / ${totalCritical}`;
            
            const allCriticalChecked = checkedCritical === totalCritical;
            const typeSelected = tradeType !== null;
            
            if (allCriticalChecked && typeSelected) {
                statusBadge.className = 'status-badge status-ready';
                statusBadge.innerHTML = 'âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ¯Ø§ÙˆÙ„';
            } else {
                statusBadge.className = 'status-badge status-wait';
                statusBadge.innerHTML = 'â¸ï¸ Ø§Ù†ØªØ¸Ø±';
            }
        }

        // Journal: Add Trade
        addTradeBtn.addEventListener('click', () => {
            tradeForm.style.display = 'block';
        });

        cancelTradeBtn.addEventListener('click', () => {
            tradeForm.style.display = 'none';
        });

        // Submit Trade
        function submitTrade(e) {
            e.preventDefault();
            
            const date = document.getElementById('tradeDate').value;
            const time = document.getElementById('tradeTime').value;
            const setup = document.getElementById('tradeSetup').value;
            const direction = document.getElementById('tradeDirection').value;
            const entry = parseFloat(document.getElementById('tradeEntry').value);
            const stop = parseFloat(document.getElementById('tradeStop').value);
            const target = parseFloat(document.getElementById('tradeTarget').value);
            const exit = parseFloat(document.getElementById('tradeExit').value);
            const followedRules = document.getElementById('tradeFollowedRules').checked;
            const emotions = document.getElementById('tradeEmotions').value;
            const notes = document.getElementById('tradeNotes').value;

            // Calculate
            const risk = direction === 'buy' ? entry - stop : stop - entry;
            const rr = risk > 0 ? Math.abs((exit - entry) / risk) : 0;
            const points = direction === 'buy' ? exit - entry : entry - exit;
            const isWin = points > 0;

            const trade = {
                id: Date.now(),
                date,
                time,
                setup,
                direction,
                entry,
                stop,
                target,
                exit,
                risk,
                rr,
                points,
                isWin,
                followedRules,
                emotions,
                notes
            };

            trades.push(trade);
            localStorage.setItem('trades', JSON.stringify(trades));
            
            tradeForm.style.display = 'none';
            renderStats();
            renderTrades();
            
            // Reset form
            document.querySelector('form').reset();
            document.getElementById('tradeFollowedRules').checked = true;
        }

        // Filtering
        filterAll.addEventListener('click', () => setFilter('all'));
        filterWin.addEventListener('click', () => setFilter('win'));
        filterLoss.addEventListener('click', () => setFilter('loss'));

        function setFilter(filter) {
            currentFilter = filter;
            filterAll.classList.toggle('active', filter === 'all');
            filterWin.classList.toggle('active', filter === 'win');
            filterLoss.classList.toggle('active', filter === 'loss');
            renderTrades();
        }

        // === Delete Functions ===
        function deleteTrade(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙÙ‚Ø©ØŸ (Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹)')) return;
            
            trades = trades.filter(t => t.id !== id);
            localStorage.setItem('trades', JSON.stringify(trades));
            renderStats();
            renderTrades();
        }

        function confirmClearAll() {
            const userInput = prompt(
                'âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙ‚Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§!\n' +
                'Ø§ÙƒØªØ¨ "Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„" Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù:'
            );
            
            if (userInput === 'Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„') {
                if (confirm('ğŸš¨ Ø®Ø·ÙˆØ© Ø£Ø®ÙŠØ±Ø©: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ 100%ØŸ Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª.')) {
                    trades = [];
                    localStorage.removeItem('trades');
                    renderStats();
                    renderTrades();
                    alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
                }
            } else if (userInput !== null) {
                alert('âŒ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­. Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù.');
            }
        }

        // Stats Rendering
        function renderStats() {
            const total = trades.length;
            const wins = trades.filter(t => t.isWin).length;
            const losses = total - wins;
            const winRate = total > 0 ? Math.round((wins / total) * 100) : 0;
            const totalPoints = trades.reduce((sum, t) => sum + t.points, 0);
            const discipline = total > 0 ? Math.round((trades.filter(t => t.followedRules).length / total) * 100) : 0;
            const avgRR = total > 0 ? (trades.reduce((sum, t) => sum + t.rr, 0) / total).toFixed(2) : 0;

            totalTradesEl.textContent = total;
            winRateEl.textContent = winRate + '%';
            winLossEl.textContent = `${wins}W / ${losses}L`;
            totalPointsEl.textContent = totalPoints.toFixed(1);
            disciplineRateEl.textContent = discipline + '%';
            avgRREl.textContent = `Avg R:R ${avgRR}`;
        }

        // Trades Rendering
        function renderTrades() {
            let filteredTrades = trades;
            if (currentFilter === 'win') filteredTrades = trades.filter(t => t.isWin);
            if (currentFilter === 'loss') filteredTrades = trades.filter(t => !t.isWin);

            if (filteredTrades.length === 0) {
                tradesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“Š</div>
                        <div>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</div>
                        <div style="margin-top: 8px; font-size: 14px; color: #64748b;">Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ© ØµÙÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
                    </div>
                `;
                return;
            }

            const html = filteredTrades.reverse().map(trade => {
                const setupNames = {
                    'pullback-vwap': 'Ø§Ø±ØªØ¯Ø§Ø¯ Ù…Ù† VWAP',
                    'breakout': 'ÙƒØ³Ø± Ù…Ø³ØªÙˆÙ‰',
                    'range-trade': 'ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù†Ø·Ø§Ù‚',
                    'trend-continuation': 'Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§ØªØ¬Ø§Ù‡'
                };
                
                return `
                    <div class="trade-card ${trade.isWin ? 'win' : 'loss'}">
                        <div class="trade-header">
                            <div class="trade-info">
                                <div class="trade-title">
                                    <span>${trade.isWin ? 'âœ…' : 'âŒ'}</span>
                                    ${setupNames[trade.setup] || trade.setup}
                                </div>
                                <div class="trade-meta">
                                    <span>${trade.date} ${trade.time}</span>
                                    <span>${trade.direction === 'buy' ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹'}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: flex-start;">
                                <div class="trade-result">
                                    <div class="trade-points ${trade.points >= 0 ? 'positive' : 'negative'}">
                                        ${trade.points >= 0 ? '+' : ''}${trade.points.toFixed(1)}
                                    </div>
                                    <div class="trade-rr">R:R ${trade.rr.toFixed(2)}</div>
                                </div>
                                <button 
                                    class="btn btn-secondary" 
                                    style="padding: 6px 12px; font-size: 12px; background: #dc2626; color: white; min-width: 60px;"
                                    onclick="deleteTrade(${trade.id})"
                                >
                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                        
                        <div class="trade-details">
                            <div>
                                <span class="trade-detail-label">Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
                                <span class="trade-detail-value">${trade.entry.toFixed(1)}</span>
                            </div>
                            <div>
                                <span class="trade-detail-label">Ø§Ù„ÙˆÙ‚Ù:</span>
                                <span class="trade-detail-value">${trade.stop.toFixed(1)}</span>
                            </div>
                            <div>
                                <span class="trade-detail-label">Ø§Ù„Ù‡Ø¯Ù:</span>
                                <span class="trade-detail-value">${trade.target.toFixed(1)}</span>
                            </div>
                            <div>
                                <span class="trade-detail-label">Ø§Ù„Ø®Ø±ÙˆØ¬:</span>
                                <span class="trade-detail-value">${trade.exit.toFixed(1)}</span>
                            </div>
                        </div>

                        <div class="trade-notes">
                            <div class="trade-note-item">
                                <span class="trade-note-label">Ø§Ù„Ù…Ø´Ø§Ø¹Ø±:</span> ${trade.emotions || 'â€”'}
                            </div>
                            <div class="trade-note-item">
                                <span class="trade-note-label">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</span> ${trade.notes || 'â€”'}
                            </div>
                        </div>

                        <div class="trade-badges">
                            ${trade.followedRules ? 
                                '<span class="badge badge-success">âœ”ï¸ Ø§Ù„ØªØ²Ù…Øª Ø¨Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯</span>' :
                                '<span class="badge badge-danger">âš ï¸ Ø®Ø§Ù„ÙØª Ø§Ù„Ø®Ø·Ø©</span>'
                            }
                        </div>
                    </div>
                `;
            }).join('');

            tradesList.innerHTML = html;
        }

        // Make deleteTrade globally accessible for inline onclick
        window.deleteTrade = deleteTrade;
    </script>
</body>
</html>